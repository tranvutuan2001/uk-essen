# Transit OpenBao Instance - Used for Auto-Unsealing Main Cluster
# Running in dev mode - automatically unsealed, root token: "root"
# ⚠️ WARNING: Dev mode is NOT for production! Use only in development/testing

server:
  ha:
    enabled: false

  dev:
    enabled: true
    devRootToken: "root"

  standalone:
    enabled: false

  dataStorage:
    enabled: false

  service:
    enabled: true
    type: ClusterIP

  ui:
    enabled: true

  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m

  postStart:
    - /bin/sh
    - -c
    - |
      sleep 5
      bao login root
      
      # Enable transit engine
      bao secrets enable transit || true
      bao write -f transit/keys/autounseal || true
      
      # Create autounseal policy
      bao policy write autounseal - <<EOF
      path "transit/encrypt/autounseal" {
         capabilities = [ "update" ]
      }
      path "transit/decrypt/autounseal" {
         capabilities = [ "update" ]
      }
      EOF
      
      # Enable Kubernetes auth
      bao auth enable kubernetes || true
      
      # Configure Kubernetes auth
      bao write auth/kubernetes/config \
        kubernetes_host="https://kubernetes.default.svc:443"
      
      # Create role for main OpenBao ServiceAccount
      bao write auth/kubernetes/role/autounseal \
        bound_service_account_names=openbao \
        bound_service_account_namespaces=openbao \
        policies=autounseal \
        ttl=1h

injector:
  enabled: false

global:
  enabled: true
  tlsDisable: true

podDisruptionBudget:
  enabled: false
