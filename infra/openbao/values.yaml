server:
  ha:
    enabled: true
    replicas: 3
    config: |
      storage "postgresql" {
        connection_url = "postgresql://admin:admin@postgres-cluster-rw.postgres.svc.cluster.local:5432/openbao_db?sslmode=disable"
        ha_enabled = "true"
      }

      listener "tcp" {
        address     = "0.0.0.0:8200"
        tls_disable = 1
      }

      seal "transit" {
        address = "http://openbao-transit:8200"
        token = "${TRANSIT_TOKEN}"
        disable_renewal = "false"
        key_name = "autounseal"
        mount_path = "transit/"
      }

      api_addr = "http://$(POD_IP):8200"
      cluster_addr = "https://$(POD_IP):8201"

      ui = true

      service_registration "kubernetes" {}

  dataStorage:
    enabled: false

  standalone:
    enabled: false

  auditStorage:
    enabled: true
    size: 1Gi

  ui:
    enabled: true

  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  extraSecretEnvironmentVars:
    - envName: TRANSIT_TOKEN
      secretName: openbao-transit-token
      secretKey: token
    - envName: PGHOST
      secretName: openbao-postgres-secret
      secretKey: PGHOST
    - envName: PGPORT
      secretName: openbao-postgres-secret
      secretKey: PGPORT
    - envName: PGUSER
      secretName: openbao-postgres-secret
      secretKey: PGUSER
    - envName: PGPASSWORD
      secretName: openbao-postgres-secret
      secretKey: PGPASSWORD
    - envName: OPENBAO_DB
      secretName: openbao-postgres-secret
      secretKey: OPENBAO_DB

injector:
  enabled: true
  replicas: 2
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m

global:
  enabled: true
  tlsDisable: true

podDisruptionBudget:
  enabled: true
  maxUnavailable: 1